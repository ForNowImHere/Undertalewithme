<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<title>Remote Window Viewer</title>
<style>
  body {margin:0;background:#000;color:#ddd;font-family:sans-serif;
        display:flex;flex-direction:column;align-items:center}
  canvas {border:2px solid #333;margin-top:10px}
  #status {margin-top:6px}
</style>
</head>
<body>
  <h2>Remote Window</h2>
  <div id="status">Connectingâ€¦</div>
  <canvas id="c"></canvas>

<script>
const canvas = document.getElementById('c'), ctx = canvas.getContext('2d');
const url  = 'ws://192.168.0.1:8765';         // â† put your server IP:PORT here
const code = new URLSearchParams(location.search).get('code')
          || prompt('Access code?');

let ws, sid, interactive=false;

function log(txt){ document.getElementById('status').textContent = txt; }

function connect(){
  ws = new WebSocket(url);
  ws.onopen = () => ws.send(JSON.stringify({tag:'hello', code}));
  ws.onmessage = ev => {
    const m = JSON.parse(ev.data);
    if(m.tag==='error'){ log('âŒ '+m.msg); ws.close(); return; }
    if(m.tag==='role'){ interactive=m.interactive; sid=m.sid;
        log(interactive?'ðŸ•¹ Control':'ðŸ‘ View'); }
    if(m.tag==='frame'){
      const img=new Image();
      img.onload=()=>{canvas.width=img.width;canvas.height=img.height;ctx.drawImage(img,0,0);};
      img.src='data:image/jpeg;base64,'+m.data;
    }
  };
}
connect();

function send(tag,data){ if(ws.readyState===1) ws.send(JSON.stringify({tag,data})); }
function mouse(e,type){
  if(!interactive) return;
  const r=canvas.getBoundingClientRect();
  send('mouse',{x:e.clientX-r.left,y:e.clientY-r.top,button:e.button,event:type});
}
canvas.onmousedown=e=>mouse(e,'down');
canvas.onmouseup  =e=>mouse(e,'up');
canvas.onmousemove=e=>mouse(e,'move');
window.onkeydown=e=>interactive&&send('key',{key:e.key,event:'down'});
window.onkeyup  =e=>interactive&&send('key',{key:e.key,event:'up'});
</script>
</body>
</html>
